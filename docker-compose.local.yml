version: '3.8'

services:
  tunehub-proxy:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: tunehub-subsonic-proxy
    restart: unless-stopped
    ports:
      - "4040:4040"
    environment:
      # Required
      - TUNEHUB_API_KEY=${TUNEHUB_API_KEY}
      # Subsonic Auth
      - SUBSONIC_USER=${SUBSONIC_USER:-admin}
      - SUBSONIC_PASSWORD=${SUBSONIC_PASSWORD:-admin}
      # Audio Settings
      - DEFAULT_QUALITY=${DEFAULT_QUALITY:-flac} # 128k | 320k | flac | flac24bit
      - SEARCH_PLATFORMS=${SEARCH_PLATFORMS:-both} # qq | netease | both
      - AUDIO_CACHE_MAX_SIZE=${AUDIO_CACHE_MAX_SIZE:-10737418240} # Default: 10GB (in bytes)
      # Server Settings
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=4040
    volumes:
      # Config folder (for .env, allowed playlists, etc.)
      - ./config:/app/config
      # Cache folder (audio files, server cache, credits log)
      - ./cache:/app/cache
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:4040/rest/ping.view?u=admin&p=admin&v=1.16.0&c=healthcheck" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
